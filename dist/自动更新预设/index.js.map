{"version":3,"file":"index.js","mappings":"AAGA,MCGaA,E,aAA8BC,OCCrCC,EAAwB,CAC5BC,KAAM,OACNC,SAAUC,UACR,GAAIC,iBAAiBC,SAASP,GAC5B,OAOF,SALqBQ,YAAYC,iBFZ1B,2DEY8DD,YAAYE,WAAWC,QAAS,GAAI,CACvGC,SAAU,KACVC,aAAc,KACdC,WAAW,MAEEN,YAAYO,aAAaC,YACtC,aAEoBC,gBAAgBjB,E,2g7HAKtCkB,WAAWlB,GACXmB,OAAOC,QAAQ,SAASpB,QAAmB,SAJzCmB,OAAOE,MAAM,gBAAiB,UAuBpChB,eAAeiB,IAff,IAA0BC,WAQ1BlB,iBACE,OAAKC,iBAAiBC,SAASP,GAGxB,GAFE,CAACE,EAGZ,CAGyBsB,IAffC,QAAQC,IACdC,gBAAgBC,eAAeF,EAAOvB,OACtC0B,QAAQD,eAAeF,EAAOvB,MAAOuB,EAAOtB,YAE9C0B,qBAAqBP,EAAQQ,IAAIL,IAAU,CAAGvB,KAAMuB,EAAOvB,KAAM6B,SAAS,KAY5E,CAEO3B,eAAe4B,IACpBX,IACAO,QAAQK,cAAcC,iBAAkBC,EAAEC,SAASf,EAAgB,IAAM,CAAEgB,UAAU,IACvF,CAEAC,EAAE,IAAMN,Y","sources":["webpack://tavern_helper_template/src/自动更新预设/更新日志.md?2feb","src://tavern_helper_template/src/自动更新预设/imports.ts","src://tavern_helper_template/src/自动更新预设/index.ts"],"sourcesContent":["// Module\nvar code = `<h1>更新日志</h1> <h2>3.5</h2> <ul> <li>总之就是更新日志</li> </ul> `;\n// Exports\nexport default code;","import raw_preset_name from './名称.txt?raw';\nimport changelog_content from './更新日志.md';\nimport preset_content from './预设.json?raw';\n\nexport { changelog_content, preset_content };\n\nexport const preset_name = raw_preset_name.trim();\n","import { changelog_content, preset_content, preset_name } from './imports';\n\ntype Button = {\n  name: string;\n  function: (() => void) | (() => Promise<void>);\n};\n\nconst import_preset: Button = {\n  name: '导入预设',\n  function: async () => {\n    if (getPresetNames().includes(preset_name)) {\n      return;\n    }\n    const result = await SillyTavern.callGenericPopup(changelog_content, SillyTavern.POPUP_TYPE.CONFIRM, '', {\n      okButton: '导入',\n      cancelButton: '取消',\n      leftAlign: true,\n    });\n    if (result !== SillyTavern.POPUP_RESULT.AFFIRMATIVE) {\n      return;\n    }\n    const success = await importRawPreset(preset_name, preset_content);\n    if (!success) {\n      toastr.error('导入预设失败, 请刷新重试', '写卡助手');\n      return;\n    }\n    loadPreset(preset_name);\n    toastr.success(`导入预设 '${preset_name}' 成功`, '写卡助手');\n  },\n};\n\nfunction register_buttons(buttons: Button[]) {\n  buttons.forEach(button => {\n    eventClearEvent(getButtonEvent(button.name));\n    eventOn(getButtonEvent(button.name), button.function);\n  });\n  replaceScriptButtons(buttons.map(button => ({ name: button.name, visible: true })));\n}\n\nasync function check_button_status(): Promise<Button[]> {\n  if (!getPresetNames().includes(preset_name)) {\n    return [import_preset];\n  }\n  return [];\n}\n\nasync function change_buttons() {\n  register_buttons(await check_button_status());\n}\n\nexport async function init_buttons() {\n  change_buttons();\n  eventOn(tavern_events.SETTINGS_UPDATED, _.throttle(change_buttons, 1000, { trailing: false }));\n}\n\n$(() => init_buttons());\n"],"names":["preset_name","trim","import_preset","name","function","async","getPresetNames","includes","SillyTavern","callGenericPopup","POPUP_TYPE","CONFIRM","okButton","cancelButton","leftAlign","POPUP_RESULT","AFFIRMATIVE","importRawPreset","loadPreset","toastr","success","error","change_buttons","buttons","check_button_status","forEach","button","eventClearEvent","getButtonEvent","eventOn","replaceScriptButtons","map","visible","init_buttons","tavern_events","SETTINGS_UPDATED","_","throttle","trailing","$"],"sourceRoot":""}