{"version":3,"file":"index.js","mappings":"qBAOMA,EAAwB,CAC5BC,KAAM,OACNC,SAAUC,UACR,GAAIC,iBAAiBC,SAAS,GAC5B,OAOF,SALqBC,YAAYC,iB,oCAAoCD,YAAYE,WAAWC,QAAS,GAAI,CACvGC,SAAU,KACVC,aAAc,KACdC,WAAW,MAEEN,YAAYO,aAAaC,UACtC,aAEoBC,gBAAgB,E,2g7HAKtCC,WAAW,GACXC,OAAOC,QAAQ,SAAS,QAAmB,SAJzCD,OAAOE,MAAM,gBAAiB,UAuBpChB,eAAeiB,IAff,IAA0BC,WAQ1BlB,iBACE,OAAKC,iBAAiBC,SAAS,GAGxB,GAFE,CAACL,EAGZ,CAGyBsB,IAffC,QAAQC,IACdC,gBAAgBC,eAAeF,EAAOvB,OACtC0B,QAAQD,eAAeF,EAAOvB,MAAOuB,EAAOtB,YAE9C0B,qBAAqBP,EAAQQ,IAAIL,IAAU,CAAGvB,KAAMuB,EAAOvB,KAAM6B,SAAS,KAY5E,CAEO3B,eAAe4B,IACpBX,IACAO,QAAQK,cAAcC,iBAAkBC,EAAEC,SAASf,EAAgB,IAAM,CAAEgB,UAAU,IACvF,CAEAC,EAAE,IAAMN,Y","sources":["src://tavern_helper_template/src/自动更新预设/index.ts"],"sourcesContent":["import { changelog_content, preset_content, preset_name } from './imports';\n\ntype Button = {\n  name: string;\n  function: (() => void) | (() => Promise<void>);\n};\n\nconst import_preset: Button = {\n  name: '导入预设',\n  function: async () => {\n    if (getPresetNames().includes(preset_name)) {\n      return;\n    }\n    const result = await SillyTavern.callGenericPopup(changelog_content, SillyTavern.POPUP_TYPE.CONFIRM, '', {\n      okButton: '导入',\n      cancelButton: '取消',\n      leftAlign: true,\n    });\n    if (result === SillyTavern.POPUP_RESULT.CANCELLED) {\n      return;\n    }\n    const success = await importRawPreset(preset_name, preset_content);\n    if (!success) {\n      toastr.error('导入预设失败, 请刷新重试', '写卡助手');\n      return;\n    }\n    loadPreset(preset_name);\n    toastr.success(`导入预设 '${preset_name}' 成功`, '写卡助手');\n  },\n};\n\nfunction register_buttons(buttons: Button[]) {\n  buttons.forEach(button => {\n    eventClearEvent(getButtonEvent(button.name));\n    eventOn(getButtonEvent(button.name), button.function);\n  });\n  replaceScriptButtons(buttons.map(button => ({ name: button.name, visible: true })));\n}\n\nasync function check_button_status(): Promise<Button[]> {\n  if (!getPresetNames().includes(preset_name)) {\n    return [import_preset];\n  }\n  return [];\n}\n\nasync function change_buttons() {\n  register_buttons(await check_button_status());\n}\n\nexport async function init_buttons() {\n  change_buttons();\n  eventOn(tavern_events.SETTINGS_UPDATED, _.throttle(change_buttons, 1000, { trailing: false }));\n}\n\n$(() => init_buttons());\n"],"names":["import_preset","name","function","async","getPresetNames","includes","SillyTavern","callGenericPopup","POPUP_TYPE","CONFIRM","okButton","cancelButton","leftAlign","POPUP_RESULT","CANCELLED","importRawPreset","loadPreset","toastr","success","error","change_buttons","buttons","check_button_status","forEach","button","eventClearEvent","getButtonEvent","eventOn","replaceScriptButtons","map","visible","init_buttons","tavern_events","SETTINGS_UPDATED","_","throttle","trailing","$"],"sourceRoot":""}